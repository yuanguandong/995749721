(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9289],{76522:(s,i,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/posts/nodejs/deploy",function(){return n(63208)}])},63208:(s,i,n)=>{"use strict";n.r(i),n.d(i,{default:()=>p,useTOC:()=>t});var e=n(86070),h=n(19422),d=n(72522),l=n(24756);let a={src:"/_next/static/media/hero.79ed7573.webp",height:600,width:800,blurDataURL:"data:image/webp;base64,UklGRkoAAABXRUJQVlA4ID4AAADwAQCdASoIAAYAAkA4JZgCdAEekijyYQAA/pj47DWhPkU5f1Dd9EwAvcrJZxVs2evvfV0/ZHb5N9aKqKAAAA==",blurWidth:8,blurHeight:6};var r=n(39942);function t(s){return[{value:"服务器",id:"服务器",depth:2},{value:"下载安装包",id:"下载安装包",depth:2},{value:"解压",id:"解压",depth:2},{value:"设置软链接",id:"设置软链接",depth:2},{value:"查看Node版本和npm版本",id:"查看node版本和npm版本",depth:2},{value:"设置npm源",id:"设置npm源",depth:2},{value:"服务器安装pm2",id:"服务器安装pm2",depth:2},{value:"配置ssh",id:"配置ssh",depth:2},{value:"将本地代码同步到服务器",id:"将本地代码同步到服务器",depth:2},{value:"服务器上启动http",id:"服务器上启动http",depth:2},{value:"本地修改发布命令",id:"本地修改发布命令",depth:2},{value:"修改http-server的监听host",id:"修改http-server的监听host",depth:2},{value:"通过ip+端口访问",id:"通过ip端口访问",depth:2}]}let p=(0,h.e)(function(s){let{toc:i=t(s)}=s,n={a:"a",code:"code",h2:"h2",img:"img",li:"li",p:"p",pre:"pre",span:"span",ul:"ul",...(0,l.R)(),...s.components};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(n.p,{children:(0,e.jsx)(n.img,{alt:"Deploy",placeholder:"blur",src:a})}),"\n",(0,e.jsx)("div",{className:"img-desc",children:"图：Nguyen Nhut"}),"\n",(0,e.jsx)(n.h2,{id:i[0].id,children:i[0].value}),"\n",(0,e.jsxs)(n.p,{children:["阿里云\n",(0,e.jsx)(n.a,{href:"https://www.aliyun.com/daily-act/ecs/activity_selection",children:"https://www.aliyun.com/daily-act/ecs/activity_selection"})]}),"\n",(0,e.jsx)(n.h2,{id:i[1].id,children:i[1].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsx)(n.code,{children:(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"wget https://nodejs.org/dist/v10.9.0/node-v10.9.0-linux-x64.tar.xz"})})})}),"\n",(0,e.jsx)(n.h2,{id:i[2].id,children:i[2].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsx)(n.code,{children:(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"tar xf  node-v10.9.0-linux-x64.tar.xz"})})})}),"\n",(0,e.jsx)(n.h2,{id:i[3].id,children:i[3].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsxs)(n.code,{children:[(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"ln -s /root/node-v10.9.0-linux-x64/bin/node   /usr/local/bin/node"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"ln -s /root/node-v10.9.0-linux-x64/bin/npm   /usr/local/bin/npm`"})})]})}),"\n",(0,e.jsx)(n.h2,{id:i[4].id,children:i[4].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsxs)(n.code,{children:[(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"node -v"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"npm -v"})})]})}),"\n",(0,e.jsx)(n.h2,{id:i[5].id,children:i[5].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsx)(n.code,{children:(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"npm config set registry  https://registry.npm.taobao.org"})})})}),"\n",(0,e.jsx)(n.h2,{id:i[6].id,children:i[6].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsxs)(n.code,{children:[(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"npm install -g pm2"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"ln -s /root/node-v10.9.0-linux-x64/bin/pm2 /usr/local/bin/"})})]})}),"\n",(0,e.jsx)(n.h2,{id:i[7].id,children:i[7].value}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["本地生成秘钥对: ",(0,e.jsx)(n.code,{children:"ssh-keygen -t rsa"}),"  demo_id_rsa"]}),"\n",(0,e.jsx)(n.li,{children:"将公钥放到服务器上:"}),"\n"]}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsx)(n.code,{children:(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"scp ~/.ssh/demo_id_rsa.pub root@39.107.238.161:/root/.ssh/authorized_keys"})})})}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["修改ssh配置 ",(0,e.jsx)(n.code,{children:"vi ~/.ssh/config"})]}),"\n"]}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsxs)(n.code,{children:[(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"Host john"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"HostName 39.107.238.161"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"User root"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"Port 22"})}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"IdentityFile ~/.ssh/demo_id_rsa"})})]})}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["服务器上修改ssh配置 ",(0,e.jsx)(n.code,{children:"vim /etc/ssh/sshd_config"})]}),"\n"]}),"\n",(0,e.jsx)(n.p,{children:"PubkeyAuthentication yes\nAuthorizedKeysFile .ssh/authorized_keys"}),"\n",(0,e.jsxs)(n.ul,{children:["\n",(0,e.jsxs)(n.li,{children:["最后就可以ssh登录了! ",(0,e.jsx)(n.code,{children:"ssh john"})]}),"\n"]}),"\n",(0,e.jsx)(n.h2,{id:i[8].id,children:i[8].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsx)(n.code,{children:(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:'rsync -avzp -e "ssh" ./Internet/ john:/root/app'})})})}),"\n",(0,e.jsx)(n.h2,{id:i[9].id,children:i[9].value}),"\n",(0,e.jsx)(n.pre,{tabIndex:"0","data-language":"plaintext","data-word-wrap":"","data-copy":"",children:(0,e.jsx)(n.code,{children:(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{children:"pm2 start /root/app/http-server.js"})})})}),"\n",(0,e.jsx)(n.h2,{id:i[10].id,children:i[10].value}),"\n",(0,e.jsx)(n.p,{children:"新建deploy.sh文件"}),"\n",(0,e.jsx)(n.pre,{icon:r.k3,tabIndex:"0","data-language":"sh","data-word-wrap":"","data-copy":"",children:(0,e.jsxs)(n.code,{children:[(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"},children:"#!/bin/bash"})}),"\n",(0,e.jsx)(n.span,{children:" "}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"HOST"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"="}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"john"})]}),"\n",(0,e.jsx)(n.span,{children:" "}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"rsync"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" -avzp"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" -e"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:' "ssh"'}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" ./Internet/"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" $HOST"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:":/root/app"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"ssh"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" $HOST "}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:'"pm2 restart /root/app/http-server.js"'})]}),"\n",(0,e.jsx)(n.span,{children:" "}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:"echo"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" 'deploy success'"})]})]})}),"\n",(0,e.jsx)(n.p,{children:"初始化npm命令"}),"\n",(0,e.jsxs)(n.p,{children:[(0,e.jsx)(n.code,{children:"npm init"}),"\n新增",(0,e.jsx)(n.code,{children:'scripts "deploy": "./deploy.sh"'})]}),"\n",(0,e.jsx)(n.p,{children:"发布"}),"\n",(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:"npm run deploy"})}),"\n",(0,e.jsx)(n.h2,{id:i[11].id,children:i[11].value}),"\n",(0,e.jsx)(n.pre,{icon:r.js,tabIndex:"0","data-language":"js","data-word-wrap":"","data-copy":"",children:(0,e.jsxs)(n.code,{children:[(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" http"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:" require"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"'http'"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:")"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" host"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:" '0.0.0.0'"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:";"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"const"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" port"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:" ="}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"},children:" 80"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:";"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"http."}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"createServer"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"},children:"function"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:" ("}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"},children:"req"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:", "}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"},children:"res"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:") {"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    res."}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"writeHead"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(## {"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"        'Content-Type'"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:": "}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"'text/plain'"})]}),"\n",(0,e.jsx)(n.span,{children:(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    })"})}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"    res."}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"end"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"'Hello World'"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:")"})]}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"})."}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"listen"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"(port, host)"})]}),"\n",(0,e.jsx)(n.span,{children:" "}),"\n",(0,e.jsxs)(n.span,{children:[(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"console."}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"},children:"log"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"("}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"`Server running at http://${"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"host"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"}:${"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:"port"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"},children:"}/`"}),(0,e.jsx)(n.span,{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"},children:")"})]})]})}),"\n",(0,e.jsx)(n.p,{children:"ECS安全组添加80端口"}),"\n",(0,e.jsx)(n.p,{children:"查看服务器上是否已正常监听80端口"}),"\n",(0,e.jsx)(n.p,{children:(0,e.jsx)(n.code,{children:"netstat -tpln"})}),"\n",(0,e.jsx)(n.h2,{id:i[12].id,children:i[12].value}),"\n",(0,e.jsx)(n.p,{children:"39.107.238.161:80"})]})},"/posts/nodejs/deploy",{filePath:"pages/posts/nodejs/deploy/index.mdx",timestamp:1732442721e3,pageMap:d.O,frontMatter:{slug:"nodejs-deploy",title:"如何部署Nodejs服务",author:"Favori",date:"2021-05-12",hero:"./hero.webp",excerpt:"如何快速的部署一个Nodejs服务到公网呢？"},title:"如何部署Nodejs服务"},"undefined"==typeof RemoteContent?t:RemoteContent.useTOC)}},s=>{var i=i=>s(s.s=i);s.O(0,[2195,636,6593,8792],()=>i(76522)),_N_E=s.O()}]);