---
slug: nodejs-cli
title: å¦‚ä½•å¼€å‘ä¸€ä¸ªcli
author: è¢å®˜ä¸œ
date: 2022-02-21
hero: ./hero.webp
excerpt: å‘½ä»¤è¡Œäº¤äº’ç•Œé¢æ˜¯ç¨‹åºå‘˜å¿…å¤‡çš„å·¥å…·ï¼Œå¦‚ä½•å¼€å‘ä¸€ä¸ªå‘¢ï¼Ÿ
---
<div className={'img-desc'}>å›¾ï¼šPhilipp KÃ¼hn</div>

import Draw from "../../../../src/@narative/gatsby-theme-novela/components/draw";

æˆ‘ä»¬æ¥å¼€å‘ä¸€ä¸ªä¸‹è½½ä»“åº“ä»£ç ï¼Œå¹¶é€šè¿‡å‘½ä»¤è¡Œç•Œé¢æ¥å¯åŠ¨é¡¹ç›®çš„åŠŸèƒ½

## å‡†å¤‡å·¥ä½œ

å®‰è£…ä»¥ä¸‹å·¥å…·,æ³¨æ„ç‰ˆæœ¬

```
clear: æ¸…å±
chalk: è£…é¥°ä½œç”¨ï¼Œä½¿ä¹‹ç»ˆç«¯ä¸Šçš„è¾“å‡ºåŠ ä¸Šé¢œè‰²
figlet: å°†å­—æ¯è½¬åŒ–ä¸ºå­—ç¬¦æ‹¼æˆçš„æ–‡å­—
git-pull-or-cloneï¼šå°†ä»£ç ä¸‹è½½
inquirer: åœ¨å‘½ä»¤è¡Œä¸­æ‰“å‡ºäº¤äº’å¼çš„å‘½ä»¤
ora: ä¼˜é›…çš„æ˜¾ç¤ºloadingæ•ˆæœ
```

## ç¼–ç 

```js
const { resolve } = require("path");
const fs = require("fs");
const { promisify } = require("util");
const chalk = require("chalk");
const inquirer = require("inquirer");
const figlet = require("figlet");
const clear = require("clear");
const ora = require("ora");
const download = promisify(require("git-pull-or-clone"));
const { spawn, log } = require("./utils");

//ä»“åº“åœ°å€
const repo = "git@github.com:yuanguandong/react-keyevent.git";

//æ¸…å±
clear();
//æ‰“å°logo
log(
  figlet.textSync("WIDGET", {
    horizontalLayout: "fitted",
    verticalLayout: "default",
    width: 80,
    whitespaceBreak: true,
  }),
  "green"
);

//ä¸»æµç¨‹
const main = async () => {
  // é¡¹â½¬åç§°
  const answer = await inquirer.prompt([
    {
      type: "input",
      message: "DirName:",
      name: "name",
      default: "widgets", // é»˜è®¤å€¼
    },
  ]);
  const dir = resolve(`./${answer.name}`);
  const process = ora(chalk["gray"](`${dir} loading.....`));
  process.start();
  try {
    await download(repo, dir);
    process.succeed();
    log(`âœ… Download Success`);
  } catch (e) {
    log(e, "red");
    process.fail();
  }
  tool(answer.name, dir);
};

//å·¥å…·æ–¹æ³•
const actions = {
  install: async ({ dir, name }) => {
    log("installing....", "gray");
    await spawn("pnpm", ["install"], { cwd: `${name}/` });
    log("âœ… Installed");
  },
  run: async ({ dir, name }) => {
    const isFile = fs.existsSync(`${dir}/node_modules`);
    if (isFile) {
      const res = await spawn("pnpm", ["run", "test"], { cwd: `${name}/` });
      return;
    } else {
      log("Not Installed", "red");
    }
  },
  exit: async ({ dir, name }) => {
    const isFile = fs.existsSync(`${dir}/node_modules`);
    if (isFile) {
      log("ğŸ–  Bye Bye!", "yellow");
    }
    return;
  },
};

//å·¥å…·ç®±
async function tool(name, dir) {
  const answer = await inquirer.prompt([
    {
      type: "rawlist",
      message: "Action",
      name: "operation",
      choices: Object.keys(actions),
    },
  ]);
  const res = await actions[answer.operation]({ dir, name });
  if (!res) {
    return;
  }
  tool(name, dir);
}

main();

module.exports = { main, tool };

```

## Utils
```js
const chalk = require("chalk");
const { spawn: _spawn } = require("child_process");

const spawn = async (...args) => {
  return new Promise((resolve) => {
    const proc = _spawn(...args);
    proc.stdout.pipe(process.stdout);
    proc.stderr.pipe(process.stderr);
    proc.on("close", (...restArgs) => {
      resolve(restArgs);
    });
  });
};

const log = (msg, color = "green", ...arg) =>
  console.log(chalk[color](msg, arg));

module.exports = { spawn, log };

```