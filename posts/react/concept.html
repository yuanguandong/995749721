<!DOCTYPE html><html><head><meta charSet="utf-8" data-next-head=""/><meta name="viewport" content="width=device-width" data-next-head=""/><meta name="title" content="reactæ¶æ„" data-next-head=""/><meta name="author" content="Favori" data-next-head=""/><link rel="icon" type="image/png" sizes="70x70" href="/favicon-70x70.png" data-next-head=""/><title data-next-head="">reactæ¶æ„</title><style data-next-head="">:root{--nextra-bg:250,250,250;}.dark{--nextra-bg:17,17,17;}</style><link rel="preload" href="/_next/static/css/552cfd626c7d3395.css" as="style"/><link rel="stylesheet" href="/_next/static/css/552cfd626c7d3395.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-42372ed130431b0a.js"></script><script src="/_next/static/chunks/webpack-7aa77703737d139f.js" defer=""></script><script src="/_next/static/chunks/framework-4e48f2cc6a39465a.js" defer=""></script><script src="/_next/static/chunks/main-d7c2d8830adc2477.js" defer=""></script><script src="/_next/static/chunks/pages/_app-b735a2408b00229b.js" defer=""></script><script src="/_next/static/chunks/2195-a5c3dde35c1c11c2.js" defer=""></script><script src="/_next/static/chunks/pages/posts/react/concept-a1e02b73dcb0c119.js" defer=""></script><script src="/_next/static/rsL7KsAc9Qt_1PtcEy7yH/_buildManifest.js" defer=""></script><script src="/_next/static/rsL7KsAc9Qt_1PtcEy7yH/_ssgManifest.js" defer=""></script></head><body><div id="__next"><script>((e,t,r,n,o,a,i,s)=>{let l=document.documentElement,u=["light","dark"];function c(t){(Array.isArray(e)?e:[e]).forEach(e=>{let r="class"===e,n=r&&a?o.map(e=>a[e]||e):o;r?(l.classList.remove(...n),l.classList.add(t)):l.setAttribute(e,t)}),s&&u.includes(t)&&(l.style.colorScheme=t)}if(n)c(n);else try{let e=localStorage.getItem(t)||r,n=i&&"system"===e?window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light":e;c(n)}catch(e){}})("class","theme","system",null,["light","dark"],null,true,true)</script><div class="Layout_container__o59WT"><header class="Header_header__aO32P"><div class="Header_headerInner__np1cA"><div class="Header_search__c61pn"></div><div class="Header_rightNav__NG1Lv"><button class="Header_themeButton__zM4Kv" aria-label="Toggle theme"><svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg></button><a href="https://github.com/yuanguandong" target="_blank" rel="noopener noreferrer" class="Header_navLink__Kg8GB"><svg height="20" viewBox="0 0 16 16" width="20" fill="currentColor"><path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"></path></svg><span class="hidden md:inline ml-1">GitHub</span></a></div></div></header><main class="Layout_main__5FFfL"><article class="_container _prose max-md:_prose-sm dark:_prose-invert" dir="ltr"><h1>reactæ¶æ„</h1><div class="_mb-8 _flex _gap-3 _items-center"><div class="_not-prose _grow dark:_text-gray-400 _text-gray-600"><div class="_flex _flex-wrap _items-center _gap-1">Favori<!-- -->,<time dateTime="2021-09-01T00:00:00.000Z">Wed Sep 01 2021</time></div></div><div class="_flex _items-center _gap-3 print:_hidden"></div></div><p><img alt="Concept" loading="lazy" width="1200" height="900" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 240&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/webp;base64,UklGRl4AAABXRUJQVlA4IFIAAACwAQCdASoIAAYAAkA4JZgCdADyfvaAAP7oM7rr7Eu/fyY+fIfUAzy6ts4xWF0dn+Ih55fH2E5WOGBxnxgxKSm6r9/ia9hau4nEV84wX34spAAA&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/hero.ab1ea4c7.webp"/></p>
<div class="img-desc">å›¾ï¼šMako Tsereteli</div>
<h2 id="æ€»ä½“" class="subheading-h2">æ€»ä½“<a href="#æ€»ä½“" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p>react çš„æ ¸å¿ƒå¯ä»¥ç”¨ ui=fn(state)æ¥è¡¨ç¤º</p>
<div class="nextra-code _relative [&amp;:not(:first-child)]:_mt-6"><pre class="nextra-focus _overflow-x-auto _subpixel-antialiased _text-[.9em] _bg-white dark:_bg-black _py-4 _ring-1 _ring-inset _ring-gray-300 dark:_ring-neutral-700 contrast-more:_ring-gray-900 contrast-more:dark:_ring-gray-50 contrast-more:_contrast-150 _rounded-md _not-prose" tabindex="0"><code class="nextra-code" dir="ltr"><span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> state</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> reconcile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(update);</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> UI</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> commit</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(state);</span></span></code></pre><div class="_opacity-0 _transition [div:hover&gt;&amp;]:_opacity-100 focus-within:_opacity-100 _flex _gap-1 _absolute _right-4 _top-2"><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5 md:_hidden" title="Toggle word wrap" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="currentColor" height="16"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5" title="Copy code" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" height="16" class="nextra-copy-icon"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5"></path></svg></button></div></div>
<p>3 å¤§æ ¸å¿ƒå¯¹è±¡ã€3 å¤§æ ¸å¿ƒé˜¶æ®µã€2 å¤§å·¥ä½œå¾ªç¯</p>
<ul>
<li>Schedulerï¼ˆè°ƒåº¦å™¨ï¼‰ï¼š æ’åºä¼˜å…ˆçº§ï¼Œè®©ä¼˜å…ˆçº§é«˜çš„ä»»åŠ¡å…ˆè¿›è¡Œ reconcile</li>
<li>Reconcilerï¼ˆåè°ƒå™¨ï¼‰ï¼š æ‰¾å‡ºå“ªäº›èŠ‚ç‚¹å‘ç”Ÿäº†æ”¹å˜ï¼Œå¹¶æ‰“ä¸Šä¸åŒçš„ Flagsï¼ˆæ—§ç‰ˆæœ¬ react å« Tagï¼‰</li>
<li>Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰ï¼š å°† Reconciler ä¸­æ‰“å¥½æ ‡ç­¾çš„èŠ‚ç‚¹æ¸²æŸ“åˆ°è§†å›¾ä¸Š</li>
</ul>
<p><img loading="lazy" width="766" height="653" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 280&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAHCAMAAAACh/xsAAAAD1BMVEX+/v719fXq6urw8PDg4ODsCMlOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAKUlEQVR4nB2KwQ0AMBCCQN1/5qb3IgEAcB5qPskyJM203zXJRfVezAoPCJcARxRYpfwAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/react1.89abef18.png"/></p>
<h2 id="schedulerè°ƒåº¦å™¨" class="subheading-h2">Schedulerï¼ˆè°ƒåº¦å™¨)<a href="#schedulerè°ƒåº¦å™¨" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p>æˆ‘ä»¬çŸ¥é“äº†è¦å®ç°å¼‚æ­¥å¯ä¸­æ–­çš„æ›´æ–°ï¼Œéœ€è¦æµè§ˆå™¨æŒ‡å®šä¸€ä¸ªæ—¶é—´ï¼Œå¦‚æœæ²¡æœ‰æ—¶é—´å‰©ä½™äº†å°±éœ€è¦æš‚åœä»»åŠ¡ï¼ŒrequestIdleCallback è²Œä¼¼æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œä½†æ˜¯å®ƒå­˜åœ¨å…¼å®¹å’Œè§¦å‘ä¸ç¨³å®šçš„åŸå› ï¼Œreact17 ä¸­é‡‡ç”¨ MessageChannel æ¥å®ç°ã€‚</p>
<p>åœ¨ Scheduler ä¸­çš„æ¯çš„æ¯ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ä½¿ç”¨è¿‡æœŸæ—¶é—´è¡¨ç¤ºçš„ï¼Œå¦‚æœä¸€ä¸ªä»»åŠ¡çš„è¿‡æœŸæ—¶é—´ç¦»ç°åœ¨å¾ˆè¿‘ï¼Œ
è¯´æ˜å®ƒé©¬ä¸Šå°±è¦è¿‡æœŸäº†ï¼Œä¼˜å…ˆçº§å¾ˆé«˜ï¼Œå¦‚æœè¿‡æœŸæ—¶é—´å¾ˆé•¿ï¼Œé‚£å®ƒçš„ä¼˜å…ˆçº§å°±ä½ï¼Œæ²¡æœ‰è¿‡æœŸçš„ä»»åŠ¡å­˜æ”¾åœ¨ timerQueue ä¸­ï¼Œ
è¿‡æœŸçš„ä»»åŠ¡å­˜æ”¾åœ¨ taskQueue ä¸­ï¼ŒtimerQueue å’Œ timerQueue éƒ½æ˜¯å°é¡¶å †ï¼Œ
æ‰€ä»¥ peek å–å‡ºæ¥çš„éƒ½æ˜¯ç¦»ç°åœ¨æ—¶é—´æœ€è¿‘ä¹Ÿå°±æ˜¯ä¼˜å…ˆçº§æœ€é«˜çš„é‚£ä¸ªä»»åŠ¡ï¼Œç„¶åä¼˜å…ˆæ‰§è¡Œå®ƒã€‚</p>
<h3 id="ä¼˜å…ˆçº§" class="subheading-h3">ä¼˜å…ˆçº§<a href="#ä¼˜å…ˆçº§" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h3>
<div class="nextra-code _relative [&amp;:not(:first-child)]:_mt-6"><pre class="nextra-focus _overflow-x-auto _subpixel-antialiased _text-[.9em] _bg-white dark:_bg-black _py-4 _ring-1 _ring-inset _ring-gray-300 dark:_ring-neutral-700 contrast-more:_ring-gray-900 contrast-more:dark:_ring-gray-50 contrast-more:_contrast-150 _rounded-md _not-prose" tabindex="0"><code class="nextra-code" dir="ltr"><span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">var</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> expirationTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> startTime </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> timeout;</span></span></code></pre><div class="_opacity-0 _transition [div:hover&gt;&amp;]:_opacity-100 focus-within:_opacity-100 _flex _gap-1 _absolute _right-4 _top-2"><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5 md:_hidden" title="Toggle word wrap" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="currentColor" height="16"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5" title="Copy code" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" height="16" class="nextra-copy-icon"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5"></path></svg></button></div></div>
<p><img loading="lazy" width="916" height="196" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 80&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAACCAMAAABSSm3fAAAADFBMVEXx8fH29vbm5ub///8SZ5DOAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAFklEQVR4nGNgYmZmYGJkYmRgYGQAYwAA4QARwf+YWQAAAABJRU5ErkJggg==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/expirtime.151286a9.png"/></p>
<h3 id="lane-æ¨¡å‹" class="subheading-h3">Lane æ¨¡å‹<a href="#lane-æ¨¡å‹" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p>react ä¹‹å‰çš„ç‰ˆæœ¬ç”¨ expirationTime å±æ€§ä»£è¡¨ä¼˜å…ˆçº§ï¼Œè¯¥ä¼˜å…ˆçº§å’Œ IO ä¸èƒ½å¾ˆå¥½çš„æ­é…å·¥ä½œï¼ˆio çš„ä¼˜å…ˆçº§é«˜äº cpu çš„ä¼˜å…ˆçº§ï¼‰ï¼Œç°åœ¨æœ‰äº†æ›´åŠ ç»†ç²’åº¦çš„ä¼˜å…ˆçº§è¡¨ç¤ºæ–¹æ³• Laneï¼ŒLane ç”¨äºŒè¿›åˆ¶ä½è¡¨ç¤ºä¼˜å…ˆçº§ï¼ŒäºŒè¿›åˆ¶ä¸­çš„ 1 è¡¨ç¤ºä½ç½®ï¼ŒåŒä¸€ä¸ªäºŒè¿›åˆ¶æ•°å¯ä»¥æœ‰å¤šä¸ªç›¸åŒä¼˜å…ˆçº§çš„ä½ï¼Œè¿™å°±å¯ä»¥è¡¨ç¤ºâ€˜æ‰¹â€™çš„æ¦‚å¿µï¼Œè€Œä¸”äºŒè¿›åˆ¶æ–¹ä¾¿è®¡ç®—ã€‚</p>
<p>è¿™å¥½æ¯”èµ›è½¦æ¯”èµ›ï¼Œåœ¨æ¯”èµ›å¼€å§‹çš„æ—¶å€™ä¼šåˆ†é…ä¸€ä¸ªèµ›é“ï¼Œæ¯”èµ›å¼€å§‹ä¹‹åå¤§å®¶éƒ½ä¼šæŠ¢å†…åœˆçš„èµ›é“ï¼ˆreact ä¸­å°±æ˜¯æŠ¢ä¼˜å…ˆçº§é«˜çš„ Laneï¼‰ï¼Œæ¯”èµ›çš„å°¾å£°ï¼Œæœ€åä¸€åèµ›è½¦å¦‚æœè½åäº†å¾ˆå¤šï¼Œå®ƒä¹Ÿä¼šè·‘åˆ°å†…åœˆçš„èµ›é“ï¼Œæœ€ååˆ°è¾¾ç›®çš„åœ°ï¼ˆå¯¹åº” react ä¸­å°±æ˜¯é¥¥é¥¿é—®é¢˜ï¼Œä½ä¼˜å…ˆçº§çš„ä»»åŠ¡å¦‚æœè¢«é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ä¸€ç›´æ‰“æ–­ï¼Œåˆ°äº†å®ƒçš„è¿‡æœŸæ—¶é—´ï¼Œå®ƒä¹Ÿä¼šå˜æˆé«˜ä¼˜å…ˆçº§ï¼‰</p>
<p>Lane çš„äºŒè¿›åˆ¶ä½å¦‚ä¸‹ï¼Œ1 çš„ bits è¶Šå¤šï¼Œä¼˜å…ˆçº§è¶Šä½</p>
<div class="nextra-code _relative [&amp;:not(:first-child)]:_mt-6"><pre class="nextra-focus _overflow-x-auto _subpixel-antialiased _text-[.9em] _bg-white dark:_bg-black _py-4 _ring-1 _ring-inset _ring-gray-300 dark:_ring-neutral-700 contrast-more:_ring-gray-900 contrast-more:dark:_ring-gray-50 contrast-more:_contrast-150 _rounded-md _not-prose" tabindex="0"><code class="nextra-code" dir="ltr"><span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//ReactFiberLane.js</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> NoLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                        */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> NoLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                          */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> SyncLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                        */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000000001</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> SyncBatchedLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                 */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000000010</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> InputDiscreteHydrationLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*      */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000000100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> InputDiscreteLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                    */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000011000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> InputContinuousHydrationLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*           */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000000100000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> InputContinuousLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                  */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000011000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> DefaultHydrationLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*            */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000000100000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> DefaultLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                   */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000000111000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> TransitionHydrationLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000000000001000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> TransitionLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                       */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000001111111110000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> RetryLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                            */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000011110000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> SomeRetryLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                  */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000010000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> SelectiveHydrationLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*          */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000100000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> NonIdleLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                                 */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000111111111111111111111111111</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> IdleHydrationLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*               */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0001000000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> IdleLanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lanes</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                             */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0110000000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span> </span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> OffscreenLane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">:</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> Lane</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                   */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b1000000000000000000000000000000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre><div class="_opacity-0 _transition [div:hover&gt;&amp;]:_opacity-100 focus-within:_opacity-100 _flex _gap-1 _absolute _right-4 _top-2"><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5 md:_hidden" title="Toggle word wrap" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="currentColor" height="16"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5" title="Copy code" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" height="16" class="nextra-copy-icon"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5"></path></svg></button></div></div>
<h2 id="reconcileråè°ƒå™¨" class="subheading-h2">Reconcilerï¼ˆåè°ƒå™¨ï¼‰<a href="#reconcileråè°ƒå™¨" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h2>
<h3 id="fiber-åŒç¼“å­˜" class="subheading-h3">Fiber åŒç¼“å­˜<a href="#fiber-åŒç¼“å­˜" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p>Fiber å¯¹è±¡ä¸Šé¢ä¿å­˜äº†åŒ…æ‹¬è¿™ä¸ªèŠ‚ç‚¹çš„å±æ€§ã€ç±»å‹ã€dom ç­‰ï¼ŒFiber é€šè¿‡ childã€siblingã€returnï¼ˆæŒ‡å‘çˆ¶èŠ‚ç‚¹ï¼‰æ¥å½¢æˆ Fiber æ ‘</p>
<p>åŒç¼“å­˜æ˜¯æŒ‡å­˜åœ¨ä¸¤é¢— Fiber æ ‘ï¼Œcurrent Fiber æ ‘æè¿°äº†å½“å‰å‘ˆç°çš„ dom æ ‘ï¼ŒworkInProgress Fiber æ˜¯æ­£åœ¨æ›´æ–°çš„ Fiber æ ‘ï¼Œè¿™ä¸¤é¢— Fiber æ ‘éƒ½æ˜¯åœ¨å†…å­˜ä¸­è¿è¡Œçš„ï¼Œåœ¨ workInProgress Fiber æ„å»ºå®Œæˆä¹‹åä¼šå°†å®ƒä½œä¸º current Fiber åº”ç”¨åˆ° dom ä¸Š</p>
<p>Fiber æœ¬è´¨æ˜¯ç¯å½¢é“¾è¡¨ç»“æ„ï¼Œå› ä¸ºè™šæ‹Ÿ dom çš„ç»“æ„è¿˜æ˜¯æ ‘ï¼Œæ‰€ä»¥ä¸€èˆ¬ç§°ä¸º Fiber æ ‘ï¼Œéå†æ–¹å¼æ˜¯æ·±åº¦ä¼˜å…ˆéå†ï¼Œchild-&gt;sibling-&gt;return,
child å’Œ sibling éƒ½æ‰§è¡Œ beginWork, return éƒ½æ‰§è¡Œ completeWork,</p>
<p><img loading="lazy" width="536" height="352" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 320 200&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/webp;base64,UklGRkQAAABXRUJQVlA4IDgAAACwAQCdASoIAAUAAkA4JZwCdAEOjhCAAP78nz+4FDwmZas46o2YmK/zFZgMTXQTWLR2pvNwDgAAAA==&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/fiber.6504d8a3.webp"/></p>
<p>éå†åˆ°æ¯ä¸ªèŠ‚ç‚¹ï¼Œéƒ½ä¼šè®¡ç®— state, å¯¹æ¯”èŠ‚ç‚¹å·®å¼‚ï¼Œä¸ºèŠ‚ç‚¹èµ‹å€¼ç›¸åº”çš„ effectFlagsã€‚</p>
<p>â€˜æ•è·â€™é˜¶æ®µå‘ç”Ÿåœ¨ beginWork å‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°åšçš„ä¸»è¦å·¥ä½œæ˜¯</p>
<ul>
<li>åˆ›å»º Fiber èŠ‚ç‚¹ï¼Œ</li>
<li>è®¡ç®— state</li>
<li>diff ç®—æ³•</li>
</ul>
<p>â€˜å†’æ³¡â€™é˜¶æ®µå‘ç”Ÿåœ¨ completeWork ä¸­ï¼Œ
è¯¥å‡½æ•°ä¸»è¦æ˜¯åšä¸€äº›æ”¶å°¾å·¥ä½œï¼Œä¾‹å¦‚</p>
<ul>
<li>å¤„ç†èŠ‚ç‚¹çš„ props</li>
<li>å½¢æˆä¸€æ¡ effectList çš„é“¾è¡¨</li>
</ul>
<p>è¯¥é“¾è¡¨æ˜¯è¢«æ ‡è®°äº†æ›´æ–°çš„èŠ‚ç‚¹å½¢æˆçš„é“¾è¡¨,commit é˜¶æ®µå…¶å®æ˜¯æ‹¿è¿™ä¸ª fiberEffectList åšæ›´æ–°</p>
<p>Reconciler ä¼šåˆ›å»ºæˆ–è€…æ›´æ–° Fiber èŠ‚ç‚¹ã€‚åœ¨ mount çš„æ—¶å€™ä¼šæ ¹æ® jsx ç”Ÿæˆ Fiber å¯¹è±¡ï¼Œ
åœ¨ update çš„æ—¶å€™ä¼šæ ¹æ®æœ€æ–°çš„ state å½¢æˆçš„ jsx å¯¹è±¡å’Œ current Fiber æ ‘å¯¹æ¯”æ„å»º workInProgress Fiber æ ‘ï¼Œ
è¿™ä¸ªå¯¹æ¯”çš„è¿‡ç¨‹å°±æ˜¯ diff ç®—æ³•ã€‚</p>
<p>åœ¨ mount æ—¶ï¼ˆé¦–æ¬¡æ¸²æŸ“ï¼‰ï¼Œä¼šæ ¹æ® jsx å¯¹è±¡ï¼ˆClass Component æˆ–çš„ render å‡½æ•°è€… Function Component çš„è¿”å›å€¼ï¼‰ï¼Œæ„å»º Fiber å¯¹è±¡ï¼Œå½¢æˆ Fiber æ ‘ï¼Œ
ç„¶åè¿™é¢— Fiber æ ‘ä¼šä½œä¸º current Fiber åº”ç”¨åˆ°çœŸå® dom ä¸Šï¼Œåœ¨ updateï¼ˆçŠ¶æ€æ›´æ–°æ—¶å¦‚ setStateï¼‰çš„æ—¶å€™ï¼Œä¼šæ ¹æ®çŠ¶æ€å˜æ›´åçš„ jsx å¯¹è±¡å’Œ current Fiber åšå¯¹æ¯”å½¢æˆæ–°çš„ workInProgress Fiberï¼Œ
ç„¶å workInProgress Fiber åˆ‡æ¢æˆ current Fiber åº”ç”¨åˆ°çœŸå® dom å°±è¾¾åˆ°äº†æ›´æ–°çš„ç›®çš„ï¼Œè€Œè¿™ä¸€åˆ‡éƒ½æ˜¯åœ¨å†…å­˜ä¸­å‘ç”Ÿçš„ï¼Œä»è€Œå‡å°‘äº†å¯¹ dom å¥½æ€§èƒ½çš„æ“ä½œã€‚</p>
<h3 id="diff-ç®—æ³•" class="subheading-h3">diff ç®—æ³•<a href="#diff-ç®—æ³•" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p>diff ç®—æ³•å‘ç”Ÿåœ¨ render é˜¶æ®µçš„ reconcileChildFibers å‡½æ•°ä¸­ï¼Œdiff ç®—æ³•åˆ†ä¸ºå•èŠ‚ç‚¹çš„ diff å’Œå¤šèŠ‚ç‚¹çš„ diffï¼ˆä¾‹å¦‚ä¸€ä¸ªèŠ‚ç‚¹ä¸­åŒ…å«å¤šä¸ªå­èŠ‚ç‚¹å°±å±äºå¤šèŠ‚ç‚¹çš„ diffï¼‰ï¼Œå•èŠ‚ç‚¹ä¼šæ ¹æ®èŠ‚ç‚¹çš„ key å’Œ typeï¼Œprops ç­‰æ¥åˆ¤æ–­èŠ‚ç‚¹æ˜¯å¤ç”¨è¿˜æ˜¯ç›´æ¥æ–°åˆ›å»ºèŠ‚ç‚¹ï¼Œå¤šèŠ‚ç‚¹ diff ä¼šæ¶‰åŠèŠ‚ç‚¹çš„å¢åˆ å’ŒèŠ‚ç‚¹ä½ç½®çš„å˜åŒ–</p>
<p>reconcile æ—¶ä¼šåœ¨è¿™äº› Fiber ä¸Šæ‰“ä¸Š Flags æ ‡ç­¾ï¼Œåœ¨ commit é˜¶æ®µæŠŠè¿™äº›æ ‡ç­¾åº”ç”¨åˆ°çœŸå® dom ä¸Šï¼Œè¿™äº›æ ‡ç­¾ä»£è¡¨èŠ‚ç‚¹çš„å¢åˆ æ”¹ï¼Œå¦‚</p>
<div class="nextra-code _relative [&amp;:not(:first-child)]:_mt-6"><pre class="nextra-focus _overflow-x-auto _subpixel-antialiased _text-[.9em] _bg-white dark:_bg-black _py-4 _ring-1 _ring-inset _ring-gray-300 dark:_ring-neutral-700 contrast-more:_ring-gray-900 contrast-more:dark:_ring-gray-50 contrast-more:_contrast-150 _rounded-md _not-prose" tabindex="0"><code class="nextra-code" dir="ltr"><span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D">//ReactFiberFlags.js</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> Placement</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*             */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000010</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> Update</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*                */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000100</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> PlacementAndUpdate</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*    */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000000110</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> Deletion</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583"> =</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D"> /*              */</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 0b0000000001000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">;</span></span></code></pre><div class="_opacity-0 _transition [div:hover&gt;&amp;]:_opacity-100 focus-within:_opacity-100 _flex _gap-1 _absolute _right-4 _top-2"><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5 md:_hidden" title="Toggle word wrap" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="currentColor" height="16"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5" title="Copy code" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" height="16" class="nextra-copy-icon"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5"></path></svg></button></div></div>
<h3 id="updatequeue" class="subheading-h3">updateQueue<a href="#updatequeue" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p>Fiber è¿˜ä¿å­˜äº†æ›´æ–°çŠ¶æ€æ—¶ç”¨äºè®¡ç®— state çš„ updateQueueï¼ŒupdateQueue æ˜¯ä¸€ç§é“¾è¡¨ç»“æ„ï¼Œä¸Šé¢å¯èƒ½å­˜åœ¨å¤šä¸ªæœªè®¡ç®—çš„ updateï¼Œupdate ä¹Ÿæ˜¯ä¸€ç§æ•°æ®ç»“æ„ï¼Œä¸Šé¢åŒ…å«äº†æ›´æ–°çš„æ•°æ®ã€ä¼˜å…ˆçº§ç­‰ï¼Œé™¤äº†è¿™äº›ä¹‹å¤–ï¼Œä¸Šé¢è¿˜æœ‰å’Œå‰¯ä½œç”¨æœ‰å…³çš„ä¿¡æ¯ã€‚</p>
<h3 id="effectlist" class="subheading-h3">effectList<a href="#effectlist" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h3>
<p>effectList ç”Ÿæˆæ–¹å¼ç¤ºä¾‹å¦‚ä¸‹ï¼š</p>
<div class="nextra-code _relative [&amp;:not(:first-child)]:_mt-6"><pre class="nextra-focus _overflow-x-auto _subpixel-antialiased _text-[.9em] _bg-white dark:_bg-black _py-4 _ring-1 _ring-inset _ring-gray-300 dark:_ring-neutral-700 contrast-more:_ring-gray-900 contrast-more:dark:_ring-gray-50 contrast-more:_contrast-150 _rounded-md _not-prose" tabindex="0"><code class="nextra-code" dir="ltr"><span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> App</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">() {</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">count</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">setCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> useState</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> (</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    &lt;&gt;</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h1</span></span>
<span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">        onClick</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> {</span></span>
<span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0">          setCount</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8"> count </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">);</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        }}</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      &gt;</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">        &lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0"> title</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">{count}&gt;{count}&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">p</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt; John</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">      &lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D">h1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">&gt;</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">    &lt;/&gt;</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">  );</span></span>
<span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8">}</span></span></code></pre><div class="_opacity-0 _transition [div:hover&gt;&amp;]:_opacity-100 focus-within:_opacity-100 _flex _gap-1 _absolute _right-4 _top-2"><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5 md:_hidden" title="Toggle word wrap" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="currentColor" height="16"><path d="M4 19h6v-2H4v2zM20 5H4v2h16V5zm-3 6H4v2h13.25c1.1 0 2 .9 2 2s-.9 2-2 2H15v-2l-3 3l3 3v-2h2c2.21 0 4-1.79 4-4s-1.79-4-4-4z"></path></svg></button><button class="_transition _border _border-gray-300 dark:_border-neutral-700 contrast-more:_border-gray-900 contrast-more:dark:_border-gray-50 _rounded-md _p-1.5" title="Copy code" type="button" data-headlessui-state=""><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" height="16" class="nextra-copy-icon"><rect x="9" y="9" width="13" height="13" rx="2"></rect><path d="M5 15H4C2.89543 15 2 14.1046 2 13V4C2 2.89543 2.89543 2 4 2H13C14.1046 2 15 2.89543 15 4V5"></path></svg></button></div></div>
<p>å½“ç‚¹å‡» h1 æ—¶ï¼Œä¼šç”Ÿæˆçº¢è‰²çº¿æ¡çš„ effectList</p>
<p><img loading="lazy" width="620" height="681" decoding="async" data-nimg="1" style="color:transparent;background-size:cover;background-position:50% 50%;background-repeat:no-repeat;background-image:url(&quot;data:image/svg+xml;charset=utf-8,%3Csvg xmlns=&#x27;http://www.w3.org/2000/svg&#x27; viewBox=&#x27;0 0 280 320&#x27;%3E%3Cfilter id=&#x27;b&#x27; color-interpolation-filters=&#x27;sRGB&#x27;%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3CfeColorMatrix values=&#x27;1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 100 -1&#x27; result=&#x27;s&#x27;/%3E%3CfeFlood x=&#x27;0&#x27; y=&#x27;0&#x27; width=&#x27;100%25&#x27; height=&#x27;100%25&#x27;/%3E%3CfeComposite operator=&#x27;out&#x27; in=&#x27;s&#x27;/%3E%3CfeComposite in2=&#x27;SourceGraphic&#x27;/%3E%3CfeGaussianBlur stdDeviation=&#x27;20&#x27;/%3E%3C/filter%3E%3Cimage width=&#x27;100%25&#x27; height=&#x27;100%25&#x27; x=&#x27;0&#x27; y=&#x27;0&#x27; preserveAspectRatio=&#x27;none&#x27; style=&#x27;filter: url(%23b);&#x27; href=&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAMAAAAC2hU0AAAACVBMVEX+/Pzt7Oz38vLIqAk4AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAI0lEQVR4nEWJsQ0AIAyAgP+PNpo2sgEACkQal+e/rzc7J6geBBYAIV/TQ3sAAAAASUVORK5CYII=&#x27;/%3E%3C/svg%3E&quot;)" src="/_next/static/media/effectlist.4f904649.png"/></p>
<h2 id="rendereræ¸²æŸ“å™¨" class="subheading-h2">Rendererï¼ˆæ¸²æŸ“å™¨ï¼‰<a href="#rendereræ¸²æŸ“å™¨" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p>Renderer å‘ç”Ÿåœ¨ commit é˜¶æ®µï¼Œcommit é˜¶æ®µéå† effectList æ‰§è¡Œå¯¹åº”çš„ dom æ“ä½œæˆ–éƒ¨åˆ†ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>Renderer æ˜¯åœ¨ commit é˜¶æ®µå·¥ä½œçš„ï¼Œcommit é˜¶æ®µä¼šéå† render(reconciler)é˜¶æ®µå½¢æˆçš„ effectListï¼Œå¹¶æ‰§è¡ŒçœŸå® dom èŠ‚ç‚¹çš„æ“ä½œå’Œä¸€äº›ç”Ÿå‘½å‘¨æœŸï¼Œä¸åŒå¹³å°å¯¹åº”çš„ Renderer ä¸åŒï¼Œä¾‹å¦‚æµè§ˆå™¨å¯¹åº”çš„å°±æ˜¯ react-domã€‚</p>
<p>commit é˜¶æ®µå‘ç”Ÿåœ¨ commitRoot å‡½æ•°ä¸­ï¼Œè¯¥å‡½æ•°ä¸»è¦éå† effectListï¼Œåˆ†åˆ«ç”¨ä¸‰ä¸ªå‡½æ•°æ¥å¤„ç† effectList ä¸Šçš„èŠ‚ç‚¹ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°æ˜¯ commitBeforeMutationEffectsã€commitMutationEffectsã€commitLayoutEffects</p>
<h2 id="concurrent" class="subheading-h2">concurrent<a href="#concurrent" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p>å®ƒæ˜¯ä¸€ç±»åŠŸèƒ½çš„åˆé›†ï¼ˆå¦‚ fiberã€schdulerã€laneã€suspenseï¼‰ï¼Œå…¶ç›®çš„æ˜¯ä¸ºäº†æé«˜åº”ç”¨çš„å“åº”é€Ÿåº¦ï¼Œä½¿åº”ç”¨ cpu å¯†é›†å‹çš„æ›´æ–°ä¸åœ¨é‚£ä¹ˆå¡é¡¿ï¼Œå…¶æ ¸å¿ƒæ˜¯å®ç°äº†ä¸€å¥—å¼‚æ­¥å¯ä¸­æ–­ã€å¸¦ä¼˜å…ˆçº§çš„æ›´æ–°ã€‚</p>
<p>æˆ‘ä»¬çŸ¥é“ä¸€èˆ¬æµè§ˆå™¨çš„ fps æ˜¯ 60Hzï¼Œä¹Ÿå°±æ˜¯æ¯ 16.6ms ä¼šåˆ·æ–°ä¸€æ¬¡ï¼Œè€Œ js æ‰§è¡Œçº¿ç¨‹å’Œ GUI ä¹Ÿå°±æ˜¯æµè§ˆå™¨çš„ç»˜åˆ¶æ˜¯äº’æ–¥çš„ï¼Œå› ä¸º js å¯ä»¥æ“ä½œ domï¼Œå½±å“æœ€åå‘ˆç°çš„ç»“æœï¼Œæ‰€ä»¥å¦‚æœ js æ‰§è¡Œçš„æ—¶é—´è¿‡é•¿ï¼Œä¼šå¯¼è‡´æµè§ˆå™¨æ²¡æ—¶é—´ç»˜åˆ¶ domï¼Œé€ æˆå¡é¡¿ã€‚react17 ä¼šåœ¨æ¯ä¸€å¸§åˆ†é…ä¸€ä¸ªæ—¶é—´ï¼ˆæ—¶é—´ç‰‡ï¼‰ç»™ js æ‰§è¡Œï¼Œå¦‚æœåœ¨è¿™ä¸ªæ—¶é—´å†… js è¿˜æ²¡æ‰§è¡Œå®Œï¼Œé‚£å°±è¦æš‚åœå®ƒçš„æ‰§è¡Œï¼Œç­‰ä¸‹ä¸€å¸§ç»§ç»­æ‰§è¡Œï¼ŒæŠŠæ‰§è¡Œæƒäº¤å›ç»™æµè§ˆå™¨å»ç»˜åˆ¶ã€‚</p>
<h2 id="æœ€å" class="subheading-h2">æœ€å<a href="#æœ€å" class="_not-prose subheading-anchor" aria-label="Permalink for this section"></a></h2>
<p>ä»¥ä¸Šå°±æ˜¯ react çš„æ ¸å¿ƒæ¶æ„è§£æï¼Œè¯¦ç»†çš„æ¯ä¸ªå—çš„åˆ†æå¯ä»¥æŸ¥é˜…å…¶ä»–æ–‡ç«  ğŸ˜¬</p></article></main><footer class="Footer_footer__hibhg"><div class="Footer_footerInner___6PzH"><div class="Footer_footerContent__7ET_v"><div class="Footer_footerLeft__6YSJc"><div class="Footer_footerMotto__hGlND"><p class="Footer_mottoContent__DZtOp"></p><p class="Footer_mottoAuthor__CLOkJ">â€”â€” </p></div></div><div class="Footer_footerRight__gZmlM"><div class="Footer_footerLinks__nX7_m"><a href="https://github.com/yuanguandong" class="Footer_footerLink__PHLXX">GitHub</a></div><div class="Footer_footerCopyright__v5EO_">Â© <!-- -->2024<!-- --> é‡å‰‘çš„åšå®¢ All rights reserved.</div><div class="Footer_footerICP__U9ArL"><a href="https://beian.miit.gov.cn/" target="_blank" rel="noopener noreferrer" class="Footer_footerLink__PHLXX">èœ€ICPå¤‡2024070350å·-3</a></div></div></div></div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{}},"page":"/posts/react/concept","query":{},"buildId":"rsL7KsAc9Qt_1PtcEy7yH","nextExport":true,"autoExport":true,"isFallback":false,"scriptLoader":[]}</script></body></html>